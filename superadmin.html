<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BLACK LIST - Ø§Ù„Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù†</title>
    <style>
        :root { --danger: #e74c3c; --dark: #1a1a1a; --gray: #f4f4f4; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #000; margin: 0; padding: 0; color: white; }
        
        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .login-box { background: #fff; padding: 30px; border-radius: 20px; width: 300px; text-align: center; color: #000; }
        .login-box input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ddd; border-radius: 10px; text-align: center; font-size: 18px; box-sizing: border-box; }
        .btn-login { width: 100%; background: #000; color: #fff; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .container { max-width: 500px; margin: 0 auto; padding: 20px; display: none; }
        .header { text-align: center; padding: 20px 0; }
        .header h1 { font-size: 24px; margin: 0; color: var(--danger); }
        
        .search-container { position: sticky; top: 10px; z-index: 10; background: #000; padding: 10px 0; }
        #search-input { width: 100%; padding: 15px; border-radius: 12px; border: none; background: #222; color: #fff; font-size: 16px; box-sizing: border-box; outline: none; border: 1px solid #333; }

        .stats { font-size: 12px; color: #888; margin: 10px 5px; }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© */
        .master-card { background: #111; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #222; transition: 0.3s; }
        .master-card:hover { border-color: var(--danger); }
        .card-info { margin-bottom: 10px; }
        .card-info b { display: block; font-size: 16px; color: #fff; }
        .card-info span { font-size: 13px; color: #aaa; }
        
        .btn-delete-final { width: 100%; background: transparent; color: var(--danger); border: 1px solid var(--danger); padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-delete-final:active { background: var(--danger); color: white; }

        #loading-text { text-align: center; color: var(--danger); font-weight: bold; margin-top: 50px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="margin:0">Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·Ù„Ù‚</h2>
            <p style="font-size:12px; color:#666">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø§Ù„Ùƒ</p>
            <input type="password" id="owner-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            <button class="btn-login" onclick="verifyOwner()">ÙØªØ­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button>
        </div>
    </div>

    <div id="super-admin-content" class="container">
        <div class="header">
            <h1>BLACK LIST <span>MASTER</span></h1>
            <p style="font-size: 12px; color:#888;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (Sheet 1)</p>
        </div>

        <div class="search-container">
            <input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† IMEI Ø£Ùˆ Ø§Ø³Ù… Ø¬Ù‡Ø§Ø²..." onkeyup="filterData()">
        </div>

        <div id="stats-bar" class="stats">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
        
        <div id="master-list">
            <div id="loading-text">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...</div>
        </div>
    </div>

<script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbyS8x7lZ40mEzbgP3tOw56ZxHnCd2XUk2dC7vdbma4J8zVDlkUkrSgivf3HApBowocjSg/exec';
    let masterData = [];

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±
    function verifyOwner() {
        const pass = document.getElementById('owner-pass').value;
        if (pass === '1634111') {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('super-admin-content').style.display = 'block';
            fetchMasterData();
        } else {
            alert('Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­!');
        }
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    async function fetchMasterData() {
        try {
            const response = await fetch(scriptUrl + "?action=getMasterData");
            masterData = await response.json();
            renderList(masterData);
        } catch (error) {
            document.getElementById('loading-text').innerText = "ğŸ”´ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
        }
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    function renderList(data) {
        const listDiv = document.getElementById('master-list');
        const statsBar = document.getElementById('stats-bar');
        listDiv.innerHTML = "";
        
        // Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ù„ØªØ®Ø·ÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
        if (data.length <= 1) {
            listDiv.innerHTML = "<div style='text-align:center; padding:50px;'>Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹</div>";
            statsBar.innerText = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø³Ø¬Ù„Ø©";
            return;
        }

        statsBar.innerText = `Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©: ${data.length - 1}`;

        for (let i = 1; i < data.length; i++) {
            const row = data[i];
            const card = document.createElement('div');
            card.className = 'master-card';
            card.innerHTML = `
                <div class="card-info">
                    <b>${row[1] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} - ${row[2] || ''}</b>
                    <span>IMEI: ${row[4] || '---'}</span>
                    <span style="display:block; font-size:11px; margin-top:5px;">Ø§Ù„Ù…Ø§Ù„Ùƒ: ${row[6] || '---'} | Ø§Ù„Ù„ÙˆÙ†: ${row[3] || '---'}</span>
                </div>
                <button class="btn-delete-final" onclick="deleteFinalRecord(${i + 1}, this)">Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© ğŸ—‘ï¸</button>
            `;
            listDiv.appendChild(card);
        }
    }

    // ÙØ­Øµ Ø§Ù„Ø¨Ø­Ø«
    function filterData() {
        const term = document.getElementById('search-input').value.toLowerCase();
        const filtered = masterData.filter((row, index) => {
            if (index === 0) return false;
            return row.join(' ').toLowerCase().includes(term);
        });
        renderList([masterData[0], ...filtered]);
    }

    // Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
    async function deleteFinalRecord(rowNum, btn) {
        if (!confirm("âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆÙ„Ù† ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…Ù‡ÙˆØ±. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;

        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...";

        try {
            await fetch(`${scriptUrl}?action=delete_master&row=${rowNum}`, { mode: 'no-cors' });
            setTimeout(() => {
                btn.closest('.master-card').style.opacity = '0.3';
                btn.innerText = "ØªÙ… Ø§Ù„Ø­Ø°Ù";
                fetchMasterData(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            }, 1000);
        } catch (error) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
            btn.disabled = false;
            btn.innerText = "Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© ğŸ—‘ï¸";
        }
    }
</script>
</body>
</html>
