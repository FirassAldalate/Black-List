<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù† - ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù</title>
    <style>
        :root { --danger: #e74c3c; --success: #27ae60; --dark: #121212; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--dark); color: white; margin: 0; padding: 15px; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #login-screen { position: fixed; inset: 0; background: #000; display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .login-box { background: #fff; padding: 30px; border-radius: 20px; text-align: center; color: #000; }
        
        .container { max-width: 500px; margin: 0 auto; display: none; }
        .search-box { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #333; background: #222; color: #fff; margin: 20px 0; box-sizing: border-box; }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ */
        .card { background: #1a1a1a; border-radius: 15px; padding: 15px; margin-bottom: 20px; border: 1px solid #333; }
        .card label { display: block; font-size: 11px; color: var(--danger); font-weight: bold; margin-bottom: 5px; }
        .card input { width: 100%; padding: 10px; background: #222; border: 1px solid #444; border-radius: 8px; color: #fff; margin-bottom: 10px; box-sizing: border-box; }
        
        .actions { display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; }
        .btn-save { background: var(--success); }
        .btn-del { background: transparent; border: 1px solid var(--danger); color: var(--danger); }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h3>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø§Ù„Ùƒ</h3>
            <input type="password" id="pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width:100%; padding:10px; margin-bottom:15px; text-align:center;">
            <button onclick="verify()" style="width:100%; padding:10px; background:#000; color:#fff; border-radius:10px;">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="content" class="container">
        <h2 style="text-align:center; color:var(--danger)">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h2>
        <input type="text" class="search-box" id="search" onkeyup="filter()" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ IMEI...">
        <div id="stats" style="font-size:12px; color:#888; margin-bottom:10px;"></div>
        <div id="master-list">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

<script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbyS8x7lZ40mEzbgP3tOw56ZxHnCd2XUk2dC7vdbma4J8zVDlkUkrSgivf3HApBowocjSg/exec';
    let masterData = [];

    function verify() {
        if(document.getElementById('pass').value === '1634111') {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            load();
        } else { alert("Ø§Ù„Ø±Ù…Ø² Ø®Ø·Ø£"); }
    }

    async function load() {
        const res = await fetch(scriptUrl + "?action=getMasterData");
        masterData = await res.json();
        render(masterData);
    }

    function render(data) {
        const list = document.getElementById('master-list');
        document.getElementById('stats').innerText = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${data.length - 1} Ø¬Ù‡Ø§Ø²`;
        list.innerHTML = "";
        
        for(let i=1; i<data.length; i++) {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <label>Ø§Ù„Ø´Ø±ÙƒØ©</label><input type="text" id="brand-${i+1}" value="${data[i][1] || ''}">
                <label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label><input type="text" id="model-${i+1}" value="${data[i][2] || ''}">
                <label>IMEI</label><input type="text" id="imei-${i+1}" value="${data[i][4] || ''}">
                <label>Ø§Ù„Ù…Ø§Ù„Ùƒ</label><input type="text" id="owner-${i+1}" value="${data[i][6] || ''}">
                <div class="actions">
                    <button class="btn btn-save" onclick="update(${i+1}, this)">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ âœ…</button>
                    <button class="btn btn-del" onclick="del(${i+1}, this)">Ø­Ø°Ù ğŸ—‘ï¸</button>
                </div>`;
            list.appendChild(card);
        }
    }

    async function update(row, btn) {
        btn.disabled = true; btn.innerText = "...";
        const brand = encodeURIComponent(document.getElementById('brand-'+row).value);
        const model = encodeURIComponent(document.getElementById('model-'+row).value);
        const imei = encodeURIComponent(document.getElementById('imei-'+row).value);
        const owner = encodeURIComponent(document.getElementById('owner-'+row).value);
        
        await fetch(`${scriptUrl}?action=update_master&row=${row}&brand=${brand}&model=${model}&imei=${imei}&owner=${owner}`, {mode:'no-cors'});
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­");
        btn.disabled = false; btn.innerText = "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ âœ…";
    }

    async function del(row, btn) {
        if(!confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) return;
        btn.innerText = "...";
        await fetch(`${scriptUrl}?action=delete_master&row=${row}`, {mode:'no-cors'});
        load();
    }

    function filter() {
        const q = document.getElementById('search').value.toLowerCase();
        const filtered = masterData.filter((r, idx) => idx !== 0 && r.join(' ').toLowerCase().includes(q));
        render([masterData[0], ...filtered]);
    }
</script>
</body>
</html>
