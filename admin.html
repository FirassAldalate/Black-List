<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ¹Ø¯ÙŠÙ„</title>
    <style>
        :root { --accent: #e74c3c; --bg: #1a1a1a; --success: #27ae60; --text-dark: #333; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        
        .container { width: 100%; max-width: 480px; background: #f9f9f9; padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        .header h1 { font-size: 20px; color: #000; margin: 0; }
        
        #status { text-align: center; font-size: 13px; font-weight: bold; margin-bottom: 15px; color: #666; }
        
        /* ØªØµÙ…ÙŠÙ… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ù„Ø¨ */
        .pending-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 20px; border: 1px solid #eee; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        .info-group { margin-bottom: 12px; display: flex; flex-direction: column; align-items: flex-start; }
        .info-group label { font-size: 12px; color: var(--accent); font-weight: bold; margin-bottom: 4px; margin-right: 5px; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ */
        .info-group input { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            font-size: 14px; 
            font-family: inherit; 
            box-sizing: border-box; 
            background: #fff;
            color: var(--text-dark);
            font-weight: 600;
        }
        .info-group input:focus { border-color: var(--success); outline: none; background: #f0fff0; }

        .btn-approve { 
            width: 100%; 
            background: var(--success); 
            color: white; 
            border: none; 
            padding: 14px; 
            border-radius: 12px; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
            margin-top: 10px; 
            transition: 0.2s;
        }
        .btn-approve:active { transform: scale(0.98); opacity: 0.9; }
        .btn-approve:disabled { background: #ccc; cursor: not-allowed; }

        .no-data { text-align: center; padding: 40px; color: #888; font-weight: bold; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #loginOverlay { position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); z-index:1000; display:flex; justify-content:center; align-items:center; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="container" style="max-width:300px; text-align:center;">
        <h2 style="margin-bottom:15px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
        <input type="password" id="passInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd; margin-bottom:15px; text-align:center;">
        <button onclick="checkLogin()" style="width:100%; background:#000; color:#fff; border:none; padding:12px; border-radius:10px; font-weight:bold;">Ø¯Ø®ÙˆÙ„</button>
        <p id="loginError" style="color:red; font-size:12px; margin-top:10px;"></p>
    </div>
</div>

<div class="container">
    <div class="header"><h1>Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</h1></div>
    <div id="status">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    <div id="pendingList"></div>
    <a href="index.html" style="display:block; text-align:center; margin-top:20px; color:#888; text-decoration:none; font-size:13px;">â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
</div>

<script>
    const pendingUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSF5W0EW-E_36UGUSpTWJkXx7gaLqjUbyz90syivKGp9D4GFWIm_yQmQxaNo_2lUmN1pM0BjH4bQPnI/pub?gid=341654715&single=true&output=csv';
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbyS8x7lZ40mEzbgP3tOw56ZxHnCd2XUk2dC7vdbma4J8zVDlkUkrSgivf3HApBowocjSg/exec';
    
    const ADMIN_PASS = "123456"; 

    function checkLogin() {
        if (document.getElementById('passInput').value === ADMIN_PASS) {
            document.getElementById('loginOverlay').style.display = 'none';
            loadPending();
        } else {
            document.getElementById('loginError').innerText = "âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£";
        }
    }

    async function loadPending() {
        const listDiv = document.getElementById('pendingList');
        const statusDiv = document.getElementById('status');
        try {
            const response = await fetch(pendingUrl + "&nocache=" + new Date().getTime());
            const data = await response.text();
            const rows = data.split('\n').filter(r => r.trim() !== '').map(r => 
                r.split(',').map(c => c.replace(/^"(.*)"$/, '$1').trim())
            );

            listDiv.innerHTML = "";
            if (rows.length <= 1) {
                statusDiv.innerHTML = "âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©";
                listDiv.innerHTML = '<div class="no-data">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                return;
            }

            statusDiv.innerHTML = `ÙŠÙˆØ¬Ø¯ (${rows.length - 1}) Ø¨Ù„Ø§ØºØ§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©`;

            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (!row[4]) continue; 
                const card = document.createElement('div');
                card.className = 'pending-card';
                card.innerHTML = `
                    <div class="info-group"><label>Ø§Ù„Ø´Ø±ÙƒØ©</label><input type="text" id="brand-${i+1}" value="${row[1] || ''}"></div>
                    <div class="info-group"><label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label><input type="text" id="model-${i+1}" value="${row[2] || ''}"></div>
                    <div class="info-group"><label>Ø§Ù„Ù„ÙˆÙ†</label><input type="text" id="color-${i+1}" value="${row[3] || ''}"></div>
                    <div class="info-group"><label>Ø±Ù‚Ù… IMEI</label><input type="number" id="imei-${i+1}" value="${row[4] || ''}"></div>
                    <div class="info-group"><label>Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø§Ù„Ùƒ</label><input type="text" id="owner-${i+1}" value="${row[6] || ''}"></div>
                    <button class="btn-approve" onclick="approveEntry(${i+1}, this)">âœ… ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ù„</button>
                `;
                listDiv.appendChild(card);
            }
        } catch (e) {
            statusDiv.innerHTML = "ğŸ”´ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
        }
    }

    async function approveEntry(rowNumber, btn) {
        if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­ÙØ¸ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ†Ù‚Ù„Ù‡Ø§ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ")) return;
        
        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ù‚Ù„...";
        
        // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
        const brand = document.getElementById(`brand-${rowNumber}`).value;
        const model = document.getElementById(`model-${rowNumber}`).value;
        const color = document.getElementById(`color-${rowNumber}`).value;
        const imei = document.getElementById(`imei-${rowNumber}`).value;
        const owner = document.getElementById(`owner-${rowNumber}`).value;

        const finalUrl = `${scriptUrl}?action=approve_with_edit&row=${rowNumber}&brand=${encodeURIComponent(brand)}&model=${encodeURIComponent(model)}&color=${encodeURIComponent(color)}&imei=${encodeURIComponent(imei)}&owner=${encodeURIComponent(owner)}`;

        try {
            await fetch(finalUrl, { mode: 'no-cors' });
            setTimeout(() => {
                btn.parentElement.style.opacity = '0.5';
                btn.innerText = "âœ”ï¸ ØªÙ… Ø§Ù„Ù†Ù‚Ù„ Ø¨Ù†Ø¬Ø§Ø­";
                loadPending();
            }, 1500);
        } catch (e) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
            btn.disabled = false;
        }
    }
</script>
</body>
</html>
