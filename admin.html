<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</title>
    <style>
        :root { --accent: #e74c3c; --bg: #1a1a1a; --success: #27ae60; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 450px; background: white; padding: 25px; border-radius: 30px; box-shadow: 0 15px 50px rgba(0,0,0,0.3); }
        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .header h1 { font-size: 22px; margin: 0; color: #000; }
        #status { text-align: center; font-size: 13px; font-weight: bold; margin-bottom: 15px; color: #666; }
        .pending-card { background: #fff; border-radius: 20px; padding: 18px; margin-bottom: 15px; border: 1px solid #eee; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .info-item { margin-bottom: 8px; font-size: 14px; display: flex; justify-content: space-between; border-bottom: 1px dashed #f0f0f0; padding-bottom: 5px; flex-direction: row-reverse; }
        .info-item b { color: var(--accent); }
        .info-item span { color: #333; font-weight: 600; }
        .btn-approve { width: 100%; background: var(--success); color: white; border: none; padding: 15px; border-radius: 15px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-approve:active { transform: scale(0.95); }
        .btn-approve:disabled { background: #ccc; }
    </style>
</head>
<body>
<div class="container">
    <div class="header"><h1>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h1></div>
    <div id="status">ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</div>
    <div id="pendingList"></div>
    <a href="index.html" style="display:block; text-align:center; margin-top:20px; color:#888; text-decoration:none; font-size:13px;">â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
</div>

<script>
    // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ Ø£ÙƒØ¯Øª Ù„Ùƒ Ø£Ù†Ù‡ ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­
    const pendingUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSF5W0EW-E_36UGUSpTWJkXx7gaLqjUbyz90syivKGp9D4GFWIm_yQmQxaNo_2lUmN1pM0BjH4bQPnI/pub?gid=341654715&single=true&output=csv';
    
    // Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Web App Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø± (Ø§Ù„Ø°ÙŠ ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ù€ /exec)
    const scriptUrl = 'Ø±Ø§Ø¨Ø·_Ø§Ù„ÙˆÙŠØ¨_Ø¢Ø¨_Ø§Ù„Ø®Ø§Øµ_Ø¨Ùƒ_Ù‡Ù†Ø§';

    async function loadPending() {
        const listDiv = document.getElementById('pendingList');
        const statusDiv = document.getElementById('status');
        try {
            const response = await fetch(pendingUrl + "&nocache=" + Math.random());
            const data = await response.text();
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù€ CSV Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ©
            const rows = data.split('\n').filter(row => row.trim() !== '').map(row => 
                row.split(',').map(cell => cell.replace(/^"(.*)"$/, '$1').trim())
            );

            listDiv.innerHTML = "";
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙ‚Ø· Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (rows.length <= 1) {
                statusDiv.innerHTML = "âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹";
                listDiv.innerHTML = '<div style="text-align:center; padding:20px; color:#888;">ÙƒÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ ÙˆÙ†Ù‚Ù„Ù‡Ø§</div>';
                return;
            }

            statusDiv.innerHTML = `ÙŠÙˆØ¬Ø¯ (${rows.length - 1}) Ø¨Ù„Ø§ØºØ§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©`;

            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (!row[4]) continue; // ØªØ®Ø·ÙŠ Ø§Ù„Ø³Ø·ÙˆØ± Ø§Ù„ÙØ§Ø±ØºØ©
                const card = document.createElement('div');
                card.className = 'pending-card';
                card.innerHTML = `
                    <div class="info-item"><b>Ø§Ù„Ø´Ø±ÙƒØ©:</b> <span>${row[1] || '---'}</span></div>
                    <div class="info-item"><b>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„:</b> <span>${row[2] || '---'}</span></div>
                    <div class="info-item"><b>IMEI:</b> <span>${row[4] || '---'}</span></div>
                    <div class="info-item"><b>Ø§Ù„Ù…Ø§Ù„Ùƒ:</b> <span>${row[6] || '---'}</span></div>
                    <button class="btn-approve" onclick="approveEntry(${i + 1}, this)">âœ… Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ†Ù‚Ù„ Ø§Ù„Ø¢Ù†</button>
                `;
                listDiv.appendChild(card);
            }
        } catch (error) {
            statusDiv.innerHTML = "ğŸ”´ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´ÙŠØª";
            console.error(error);
        }
    }

    async function approveEntry(rowNumber, btn) {
        if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ù‚Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„Ø§Øº Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ")) return;
        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ù‚Ù„...";
        try {
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø£ÙƒØ´Ù† Ù…Ù† Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª
            await fetch(`${scriptUrl}?action=approve&row=${rowNumber}`, { mode: 'no-cors' });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆÙ†ØµÙ
            setTimeout(() => {
                btn.parentElement.remove();
                loadPending();
            }, 1500);
        } catch (error) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
            btn.disabled = false;
        }
    }
    loadPending();
</script>
</body>
</html>
